<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>大事件-后台登录页</title>
  <link rel="stylesheet" type="text/css" href="css/reset.css" />
  <link rel="stylesheet" type="text/css" href="css/iconfont.css" />
  <link rel="stylesheet" type="text/css" href="css/main.css" />
  <!-- 引入bootstrap的css文件 -->
  <link rel="stylesheet" href="./libs/bootstrap/css/bootstrap.min.css" />
  <!-- 引入jq文件 -->
  <script src="./libs/jquery-1.12.4.min.js"></script>
  <!-- 引入bootstrap的js文件 -->
  <script src="./libs/bootstrap/js/bootstrap.min.js"></script>
</head>

<body>
  <div class="main_wrap">
    <div class="header">
      <a href="#" class="logo"><img src="images/logo.png" alt="" /></a>
      <div class="copyright">
        CopyRight © 2019 深圳百秀信息技术股份有限公司<br />All Rights Reserved
      </div>
    </div>

    <div class="login_form_con">
      <div class="login_title"></div>
      <form class="login_form">
        <i class="iconfont icon-user"></i>
        <i class="iconfont icon-key"></i>
        <input type="text" class="input_txt" placeholder="邮箱/手机号" />
        <input type="password" class="input_pass" placeholder="密码" />
        <input type="submit" class="input_sub" value="登 录" />
      </form>
    </div>
  </div>

  <!-- bootstrap 模态框 -->
  <div id="myModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
              aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">温馨提示</h4>
        </div>
        <div class="modal-body">
          <p></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">关 闭</button>
          <!-- <button type="button" class="btn btn-primary">清空重写</button> -->
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

</body>

</html>

<script>
  /* 
    登录页的JS业务代码
    目标：登录页实现
    步骤：
      1. 给登录按钮绑定点击事件（注意阻止默认行为）
      2. 在点击事件内部获取 用户名和密码
      3. 对用户输入的内容进行非空判断
      4. 不为空的情况下才发送 ajax 请求
      5. 打印服务器返回的数据。
      ...
      请求地址：/admin/user/login
      请求方式：post
      请求参数：
      | 名称     | 类型   | 说明            |
      | -------- | ------ | ------------- |
      | username | string | 用户名（admin） |
      | password | string | 密码(123456)   |
  */
  // 入口函数
  $(function () {
    // 1. 给登录按钮绑定点击事件
    $('.input_sub').click(function (e) {
      // 1.1 注意阻止默认行为
      e.preventDefault();
      // 2. 在点击事件内部获取 用户名和密码
      const user = $('.input_txt').val().trim();
      const pwd = $('.input_pass').val().trim();
      // 3. 对用户输入的内容进行非空判断
      if (user === '' && pwd === '') {
        // alert('用户名和密码不能为空！')
        showModal('用户名和密码不能为空！')
      } else if (user === '') {
        // alert('用户名不能为空！');
        showModal('用户名不能为空！')
      } else if (pwd === '') {
        // alert('密码不能为空！');
        showModal('密码不能为空！')
      } else {
        // 4. 不为空的情况下才发送 ajax 请求
        $.ajax({
          type: "post",
          url: "http://localhost:8080/api/v1/admin/user/login",
          data: {
            username: user,
            password: pwd
          },
          success: function (response) {
            debugger;
            console.log(response);
            if (response.code === 200) {
              // 登录成功后，返回的token通过本地存储保存起来
              localStorage.setItem('token', response.token);
              // 跳转到首页
              location.href = './index.html';

            } else {
              // 反之根据返回的内容提示
              // alert(response.msg);
              showModal(response.msg);
            }
          }
        });


      }

    });

    // 封装 bootstrap 模态框
    function showModal(res) {
      $('#myModal').modal()
      $('.modal-body').text(res)
    }

  })
</script>
